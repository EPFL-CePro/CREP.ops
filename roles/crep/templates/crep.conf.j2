<VirtualHost *:80>
    ServerName {{ crep_host_subdomain }}
    ServerAdmin cepro-exams@epfl.ch

    # Redirection HTTP -> HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} !=on
    RewriteRule ^/?(.*) https://{{ crep_host_subdomain }}/$1 [R=301,L]
</VirtualHost>

<VirtualHost *:443>
    ServerName {{ crep_host_subdomain }}
    ServerAdmin cepro-exams@epfl.ch

    ErrorLog ${APACHE_LOG_DIR}/{{ crep_host_subdomain | replace('.', '_') }}-error.log
    CustomLog ${APACHE_LOG_DIR}/{{ crep_host_subdomain | replace('.', '_') }}-access.log combined
    LogLevel warn

    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:3000/
    ProxyPassReverse / http://127.0.0.1:3000/

    <Location />
        Require all granted
    </Location>

	SSLEngine on
	SSLProtocol ALL -SSLv2 -SSLv3 -TLSv1 -TLSv1.1 +TLSv1.2
	SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
	SSLHonorCipherOrder on
	SSLCertificateKeyFile /etc/ssl/certs/crep/crep-serveur.key 
	SSLCertificateFile /etc/ssl/certs/crep/crep_epfl_ch-crt.pem 
	SSLCertificateChainFile /etc/ssl/certs/crep/crep_epfl_ch-crt.pem

</VirtualHost>